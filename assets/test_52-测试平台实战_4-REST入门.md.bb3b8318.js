import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.1b72a0e7.js";const A=JSON.parse('{"title":"四、REST 入门","description":"","frontmatter":{},"headers":[],"relativePath":"test/52-测试平台实战/4-REST入门.md","lastUpdated":1699519576000}'),p={name:"test/52-测试平台实战/4-REST入门.md"},o=l(`<h1 id="四、rest-入门" tabindex="-1">四、REST 入门 <a class="header-anchor" href="#四、rest-入门" aria-label="Permalink to &quot;四、REST 入门&quot;">​</a></h1><h2 id="一、-数据库查询强化训练" tabindex="-1">一、 数据库查询强化训练 <a class="header-anchor" href="#一、-数据库查询强化训练" aria-label="Permalink to &quot;一、 数据库查询强化训练&quot;">​</a></h2><h3 id="_1-字段条件查询" tabindex="-1">1. 字段条件查询 <a class="header-anchor" href="#_1-字段条件查询" aria-label="Permalink to &quot;1. 字段条件查询&quot;">​</a></h3><p>字段查询是指如何指定 SQL WHERE 子句的内容。</p><p>它们用作<code>QuerySet的filter()</code>, <code>exclude()</code>和<code>get()</code>方法的关键字参数。</p><p>其基本格式是：<code>field__lookuptype=value</code>，注意其中是 <code>双下划线</code>。</p><p>默认查找类型为 exact(精确匹配)。</p><p>lookuptype 的类型有：</p><p>Django 的数据库 API 支持 20 多种查询类型，下表列出了所有的字段查询参数：</p><table><thead><tr><th>字段名</th><th>说明</th></tr></thead><tbody><tr><td>exact</td><td>精准匹配</td></tr><tr><td>iexact</td><td>不区分大小写的精准匹配</td></tr><tr><td>contains</td><td>包含匹配</td></tr><tr><td>icontains</td><td>不区分大小写的包含匹配</td></tr><tr><td>in</td><td>在 。。。之内的匹配</td></tr><tr><td>gt</td><td>大于</td></tr><tr><td>gte</td><td>大于等于</td></tr><tr><td>lt</td><td>小于</td></tr><tr><td>lte</td><td>小于等于</td></tr><tr><td>startswith</td><td>从开头匹配</td></tr><tr><td>istartswith</td><td>不区分大小写的从开头匹配</td></tr><tr><td>endswith</td><td>从结尾处匹配</td></tr><tr><td>iendswith</td><td>不区分大小写的从结尾处匹配</td></tr><tr><td>range</td><td>范围匹配</td></tr><tr><td>date</td><td>日期匹配</td></tr><tr><td>year</td><td>年份匹配</td></tr><tr><td>iso_year</td><td>以 ISO 8601 标准确定的年份</td></tr><tr><td>month</td><td>月份</td></tr><tr><td>day</td><td>日期</td></tr><tr><td>week</td><td>第几周</td></tr><tr><td>ios_week_day</td><td>以 ISO 8601 标准确定的星期几</td></tr><tr><td>quarter</td><td>季度</td></tr><tr><td>time</td><td>时间</td></tr><tr><td>hour</td><td>小时</td></tr><tr><td>minute</td><td>分钟</td></tr><tr><td>second</td><td>秒</td></tr><tr><td>regex</td><td>区分大小写的正则匹配</td></tr><tr><td>iregex</td><td>不区分大小写的正则匹配</td></tr></tbody></table><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 字段查询</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestFieldQuery</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">TestCase</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">setUp</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None:</span></span>
<span class="line"><span style="color:#A6ACCD;">		Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/api/request/demo1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">={</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小明</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">18</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">addr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nanjing</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">father</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xiaogang</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">40</span><span style="color:#89DDFF;">}})</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">test_contains_query</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">		req </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url__contains</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">demo</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">req</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">test_in_query</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">		req </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url__in</span><span style="color:#89DDFF;">=[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/api/request/demo1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/api/request/demo2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">req</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>执行测试</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">python</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">manage.py</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sqtp.tests.TestFieldQuery</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-夸关系查询" tabindex="-1">2. 夸关系查询 <a class="header-anchor" href="#_2-夸关系查询" aria-label="Permalink to &quot;2. 夸关系查询&quot;">​</a></h3><p>Django 提供了强大并且直观的方式解决跨越关联的查询，它在后台自动执行包含 JOIN 的 SQL 语句。</p><p>要跨越某个关联，只需使用关联的模型字段名称，并使用双下划线分隔，直至你想要的字段（可以链式跨 越，无限跨度）.</p><p>例如</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查找标签是xxx的用例</span></span>
<span class="line"><span style="color:#A6ACCD;">res1</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Case</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">tags__name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">smoketest</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>案例：</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#跨关系查询</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestOverRelations</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">TestCase</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">setUp</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None:</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#676E95;font-style:italic;"># 创建套件和用例</span></span>
<span class="line"><span style="color:#A6ACCD;">		self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">suite_conf</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Config</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">套件1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">suite</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Suite</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">config</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">suite_conf</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">config</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Config</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">用例1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">case</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Case</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">config</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">config</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">suite</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">suite</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#676E95;font-style:italic;"># 查找某套件下的用例步骤</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">test_case_step</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">		Step</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">belong_case</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">case</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">步骤1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		Step</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">belong_case</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">case</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">步骤2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		Step</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">belong_case</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">case</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">步骤3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		steps</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Step</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">belong_case__suite__config__name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">套件1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">		</span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">steps</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h2 id="二、-接口开发实战-rest-框架入门" tabindex="-1">二、 接口开发实战 - REST 框架入门 <a class="header-anchor" href="#二、-接口开发实战-rest-框架入门" aria-label="Permalink to &quot;二、 接口开发实战 - REST 框架入门&quot;">​</a></h2><p><a href="https://www.django-rest-framework.org/" target="_blank" rel="noreferrer">Django REST framework</a>（以下简称 DRF 或 REST 框架）是一个开源的 Django 扩展，提供了便捷的 REST API 开发框架，拥有以下特性：</p><ul><li>直观的 API web 界面。</li><li>多种身份认证和权限认证方式的支持。</li><li>内置了 OAuth1 和 OAuth2 的支持。</li><li>内置了限流系统。</li><li>根据 Django ORM 或者其它库自动序列化。</li><li>丰富的定制层级：函数视图、类视图、视图集合到自动生成 API，满足各种需要。</li><li>可扩展性，插件丰富。</li><li>广泛使用，文档丰富</li></ul><h3 id="_1-安装-rest-djangorestframework-框架" tabindex="-1">1. 安装 REST （djangorestframework）框架 <a class="header-anchor" href="#_1-安装-rest-djangorestframework-框架" aria-label="Permalink to &quot;1. 安装 REST （djangorestframework）框架&quot;">​</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">pip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">djangorestframework</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_2-配置-rest-djangorestframework-框架" tabindex="-1">2. 配置 REST （djangorestframework）框架 <a class="header-anchor" href="#_2-配置-rest-djangorestframework-框架" aria-label="Permalink to &quot;2. 配置 REST （djangorestframework）框架&quot;">​</a></h3><p>在 settings.py 中 注册 REST 框架</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># settings.py</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">INSTALLED_APPS </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">rest_framework</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-rest-运行原理" tabindex="-1">3. REST 运行原理 <a class="header-anchor" href="#_3-rest-运行原理" aria-label="Permalink to &quot;3. REST 运行原理&quot;">​</a></h3><p><img src="https://img.pupper.cn/img/20220726100110.png" alt=""></p><p>相比于原生 django 开发的 web 应用，多了一层序列化器(Serializer)</p><p>序列化器和表单都是基于 Field 进行字段验证，而 Field 都来自于 rest_framework.fields 模块，相当于把 django 的封装了一层。</p><h2 id="三、-rest-框架基本组件-serializer" tabindex="-1">三、 REST 框架基本组件 --- Serializer <a class="header-anchor" href="#三、-rest-框架基本组件-serializer" aria-label="Permalink to &quot;三、 REST 框架基本组件 --- Serializer&quot;">​</a></h2><p>Serializer 的作用：实现序列化和 反序列化</p><ul><li>序列化 ： 就是将 python 数据对象 转化 成方便传输的文本格式， 如 json、xml 等</li><li>反序列化 ： 就是将 文本格式的 数据 转化为 python 数据对象</li></ul><blockquote><p>序列化 通常定义在 应用程序下单独文件中 <code>serializer.py</code></p></blockquote><h3 id="_1-模型改造-添加元类" tabindex="-1">1. 模型改造，添加元类 <a class="header-anchor" href="#_1-模型改造-添加元类" aria-label="Permalink to &quot;1. 模型改造，添加元类&quot;">​</a></h3><p>模型的元数据 ： 是指除了字段为的所有内容，比如 排序方式，数据库名等等</p><p>增加元数据的方法 ： 在模型类中添加 子类， 名字固定为 <code>Meta</code>， 然后在这个 子类 下 增加各种元数据选项。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> django</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">db </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> models</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Request</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">models</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">Model</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">	...</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Meta</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># 模型元类的作用：为模型增加额外的信息，如模型对应表名，</span></span>
<span class="line"><span style="color:#A6ACCD;">		ordering </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># 数据根据ID排序</span></span>
<span class="line"><span style="color:#A6ACCD;">		db_table </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">reqquest</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># 模型对应的数据库表名，不设置则默认为app名_模型名</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_2-创建-序列化类" tabindex="-1">2. 创建 序列化类 <a class="header-anchor" href="#_2-创建-序列化类" aria-label="Permalink to &quot;2. 创建 序列化类&quot;">​</a></h3><p>开发我们的 Web API 的第一件事是为我们的 Web API 提供一种将代码片段实例序列化和反序列化为诸如 json 之类的表示形式的方式 。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># serializer.py</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> rest_framework </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> serializers</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqtp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">models </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Step</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Request</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">RequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">serializers</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">Serializer</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">	method_choices </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># method可选字段，二维元组</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># 参数1：保存在数据库中的值，参数2：对外显示的值</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">PUT</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DELETE</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    step </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> serializers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">RelatedField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">queryset</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">Step</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;font-style:italic;">allow_null</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    method </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> serializers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ChoiceField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">choices</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">method_choices</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">default</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> serializers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">CharField</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    params </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> serializers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">JSONField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">allow_null</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    headers </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> serializers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">JSONField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">allow_null</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    cookies </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> serializers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">JSONField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">allow_null</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> serializers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">JSONField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">allow_null</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    json </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> serializers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">JSONField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">allow_null</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">validated_data</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		根据提供的验证过的数据创建并返回一个新的\`Snippet\`实例。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(**</span><span style="color:#82AAFF;">validated_data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">update</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">instance</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">validated_data</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		根据提供的验证过的数据创建并返回一个新的\`Snippet\`实例。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">		</span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">step</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">validated_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">step</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">step</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">method</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">validated_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">method</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">url</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">validated_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">params</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">validated_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">params</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">params</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">headers</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">validated_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">cookies</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">validated_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cookies</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">cookies</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">validated_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">json</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">validated_data</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">instance</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">json</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>序列化器类的第一部分定义了序列化/反序列化的字段。</p><p>create() 和 update() 方法定义了在调用 serializer.save() 时如何创建和修改完整的实例</p><h3 id="_3-使用序列化类" tabindex="-1">3. 使用序列化类 <a class="header-anchor" href="#_3-使用序列化类" aria-label="Permalink to &quot;3. 使用序列化类&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># sqtp/test_serializers.py</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> django</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">test </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> TestCase</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqtp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">models </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Step</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Request</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqtp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">serializers </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> RequestSerializer</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> rest_framework</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">renderers </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> JSONRenderer</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> rest_framework</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">parsers </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> JSONParser</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestRequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">TestCase</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    req1</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/demo1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">={</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小明</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">18</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">addr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nanjing</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">    req2</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">create</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/demo1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">params</span><span style="color:#89DDFF;">={</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小明</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">18</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">addr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nanjing</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 序列化:数据对象--&gt;&gt;python原生数据类型</span></span>
<span class="line"><span style="color:#A6ACCD;">    req1_serializer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">req1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">req1_serializer</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 序列化数据存储在序列化对象的data属性中</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 序列化:python原生数据类型--&gt;&gt;json</span></span>
<span class="line"><span style="color:#A6ACCD;">    content </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">JSONRenderer</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">render</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">req1_serializer</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">content</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>执行测试</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">python</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">manage.py</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sqtp.test_serializers</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>返回</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">step</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: None, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">method</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/demo1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">params</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: None, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: None,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cookies</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: None, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小明</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">18</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">addr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nanjing</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: None</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">b</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{&quot;step&quot;:null,&quot;method&quot;:0,&quot;url&quot;:&quot;/demo1&quot;,&quot;params&quot;:null,&quot;headers&quot;:null,&quot;cookies&quot;:null,&quot;data&quot;:{&quot;name&quot;:&quot;\\xe5\\xb0\\x8f\\xe6\\x98\\x8e&quot;,&quot;age&quot;:18,&quot;addr&quot;:&quot;nanjing&quot;},&quot;json&quot;:null}</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>反序列化是类似的。测试类再新增以下代码，实现反序列化</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 反序列化1: 将流（stream）解析为Python原生数据类型.</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> io</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">stream </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> io</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">BytesIO</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">content</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 构建1个steam流</span></span>
<span class="line"><span style="color:#A6ACCD;">data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">JSONParser</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">parse</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">stream</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 转成python原生数据类型</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 反序列化2: Python原生数据类型恢复成正常的对象实例。</span></span>
<span class="line"><span style="color:#A6ACCD;">serializer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 序列化器</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">is_valid</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;">       </span><span style="color:#676E95;font-style:italic;"># 校验数据是否合法</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">validated_data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># 查看数据对象</span></span>
<span class="line"><span style="color:#A6ACCD;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">save</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 保存数据</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>执行测试</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">python</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">manage.py</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sqtp.test_serializers</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>返回</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#FFCB6B;">True</span></span>
<span class="line"><span style="color:#FFCB6B;">OrderedDict([(&#39;step&#39;,</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">None</span><span style="color:#A6ACCD;">), </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">method</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/demo1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">params</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, None</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, None</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cookies</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, None</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小明</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">18</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">addr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nanjing</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, None</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">])</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>除了序列化模型实例，序列化器还可以序列化查询结果集（querysets），只需要为 serializer 添加一个 <code>many=True</code> 标志。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 序列化查询结果集（querysets）</span></span>
<span class="line"><span style="color:#A6ACCD;">serializers</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;font-style:italic;">many</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">serializers</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-改进-序列化器-重点" tabindex="-1">4. 改进 序列化器（重点） <a class="header-anchor" href="#_4-改进-序列化器-重点" aria-label="Permalink to &quot;4. 改进 序列化器（重点）&quot;">​</a></h3><p>用 <code>ModelSerializer</code> 代替 <code>Serializer</code> 类作为自定义序列化器的父类，减少重复代码的编写</p><h4 id="使用-modelserializer-重构序列化类" tabindex="-1">使用 <code>ModelSerializer</code> 重构序列化类 <a class="header-anchor" href="#使用-modelserializer-重构序列化类" aria-label="Permalink to &quot;使用 \`ModelSerializer\` 重构序列化类&quot;">​</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> rest_framework </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> serializers</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqpt</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">models </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Step</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Config</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> Case</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 请求模型的序列化器</span></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">RequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">serializers</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">ModelSerializer</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Meta</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        model </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Request  </span><span style="color:#676E95;font-style:italic;"># 指定对应的模型</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># 定义可以显示和操作的字段</span></span>
<span class="line"><span style="color:#A6ACCD;">        fields </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">step</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">method</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">params</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>打印序列化器类实例的结构(representation)查看它的所有字段</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># test_serializers.py</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 在测试类中添加代码，查看序列化器的内部结构</span></span>
<span class="line"><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">repr</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">serializer</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>返回</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">RequestSerializer(data=</span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">13</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">step</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: None, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">method</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/demo1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">params</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: None, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: None,</span></span>
<span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小明</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">18</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">addr</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nanjing</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">: None</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">):</span></span>
<span class="line"><span style="color:#FFCB6B;">id</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">IntegerField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">label</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ID</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> read_only</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">True</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">step</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">PrimaryKeyRelatedField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">allow_null</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">True,</span><span style="color:#A6ACCD;"> queryset</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">Step.objects.all</span><span style="color:#89DDFF;">()</span><span style="color:#C3E88D;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">required</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">False,</span><span style="color:#A6ACCD;"> validators</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">[</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">Un</span></span>
<span class="line"><span style="color:#FFCB6B;">iqueValidator(queryset=Request.objects.all(</span><span style="color:#89DDFF;">))&gt;</span><span style="color:#C3E88D;">]</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">method</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ChoiceField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">choices</span><span style="color:#89DDFF;">=((</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> &#39;GET&#39;)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> &#39;POST&#39;)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> &#39;PUT&#39;)</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">&#39;DELETE&#39;)), label=&#39;请求方法&#39;, requir</span></span>
<span class="line"><span style="color:#C3E88D;">ed=False,</span><span style="color:#A6ACCD;"> validators</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">[</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">django.core.validators.MinValueValidator</span><span style="color:#A6ACCD;"> object</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">django.core.validators.MaxValueValida</span></span>
<span class="line"><span style="color:#FFCB6B;">tor</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">objec</span><span style="color:#A6ACCD;">t</span><span style="color:#89DDFF;">&gt;</span><span style="color:#C3E88D;">]</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">url</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CharField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">label</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">请求路径</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> max_length</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1000</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> required</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">False</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">params</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">JSONField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">allow_null</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">True,</span><span style="color:#A6ACCD;"> decoder</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">None,</span><span style="color:#A6ACCD;"> encoder</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">None,</span><span style="color:#A6ACCD;"> label</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Url参</span></span>
<span class="line"><span style="color:#C3E88D;">数</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> required</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">False,</span><span style="color:#A6ACCD;"> style</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ba</span></span>
<span class="line"><span style="color:#C3E88D;">se_template</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">textarea.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">}</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">headers</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">JSONField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">allow_null</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">True,</span><span style="color:#A6ACCD;"> decoder</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">None,</span><span style="color:#A6ACCD;"> encoder</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">None,</span><span style="color:#A6ACCD;"> label</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">请求</span></span>
<span class="line"><span style="color:#C3E88D;">头</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> required</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">False,</span><span style="color:#A6ACCD;"> style</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ba</span></span>
<span class="line"><span style="color:#C3E88D;">se_template</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">textarea.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">}</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">data</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">JSONField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">allow_null</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">True,</span><span style="color:#A6ACCD;"> decoder</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">None,</span><span style="color:#A6ACCD;"> encoder</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">None,</span><span style="color:#A6ACCD;"> label</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Data参</span></span>
<span class="line"><span style="color:#C3E88D;">数</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> required</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">False,</span><span style="color:#A6ACCD;"> style</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bas</span></span>
<span class="line"><span style="color:#C3E88D;">e_template</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">textarea.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">}</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#FFCB6B;">json</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">JSONField</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">allow_null</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">True,</span><span style="color:#A6ACCD;"> decoder</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">None,</span><span style="color:#A6ACCD;"> encoder</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">None,</span><span style="color:#A6ACCD;"> label</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Json参</span></span>
<span class="line"><span style="color:#C3E88D;">数</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span><span style="color:#A6ACCD;"> required</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">False,</span><span style="color:#A6ACCD;"> style</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">{</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">bas</span></span>
<span class="line"><span style="color:#C3E88D;">e_template</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">textarea.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">}</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p><code>ModelSerializer</code> 类并不会做任何特别神奇的事情，它们只是创建序列化器类的快捷方式：</p><ul><li>一组自动确定的字段。</li><li>默认简单实现的 create() 和 update() 方法</li></ul><h3 id="_5-视图编写" tabindex="-1">5. 视图编写 <a class="header-anchor" href="#_5-视图编写" aria-label="Permalink to &quot;5. 视图编写&quot;">​</a></h3><p>编辑 <code>sqtp/views.py</code>，导入以下库</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> django</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">http </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> HttpResponse</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> JsonResponse</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> django</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">views</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">decorators</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">csrf </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> csrf_exempt</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> rest_framework</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">parsers </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> JSONParser</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqtp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">models </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Request</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqtp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">serializers </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> RequestSerializer</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>编写一个视图可以返回所有的请求数据</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">request_list</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">method</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        serializer</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;font-style:italic;">many</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># safe=False是为了支持{}以外的python对象转json</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">JsonResponse</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">safe</span><span style="color:#89DDFF;">=False)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>创建 <code>sqtp/urls.py</code>, 写入路由</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> django</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">urls </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> path</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqtp </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> views</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">urlpatterns </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">path</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">requests/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">views</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">request_list</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>总路由引入子路由 <code>autotpsite/urls.py</code></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> django</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">urls </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">include</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">urlpatterns </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">path</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">include</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sqtp.urls</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>启动 server 服务并测试</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">python</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">manage.py</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">runserver</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_6-接口开发-drf-进阶" tabindex="-1">6. 接口开发-DRF-进阶 <a class="header-anchor" href="#_6-接口开发-drf-进阶" aria-label="Permalink to &quot;6. 接口开发-DRF-进阶&quot;">​</a></h3><p>接口开发本质上是处理请求和响应，包括了处理请求参数，判断请求方法，处理响应字段，响应码等</p><p>第一个工具，函数视图 <code>装饰器 @api_view</code></p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> django</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">http </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> HttpResponse</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> JsonResponse</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> rest_framework</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">decorators </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> api_view</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqtp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">models </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Request</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> rest_framework</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">response </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Response</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqtp</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">serializers </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> RequestSerializer</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">api_view</span><span style="color:#89DDFF;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">POST</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 允许的请求方法</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">request_list</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">format</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">method</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># 构造序列化器</span></span>
<span class="line"><span style="color:#A6ACCD;">        serializer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">(),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">many</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># 返回 json 格式数据</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># safe=False 是为了支持 {} 以外的 python 对象转 json</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Response</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># 将 python 原生格式转成 json 数据</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="https://img.pupper.cn/img/20220726100154.png" alt=""></p><p>装饰器的作用是 确保你在视图中接收到 Request 实例，并将上下文添加到 Response ，以便可以执行内容协商 .</p><p>包装器还提供了诸如在适当时候返回 405 Method Not Allowed 响应，并处理在使用格式错误的输入来访问 request.data 时发生的任何 ParseError 异常</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">api_view</span><span style="color:#89DDFF;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">request_detail</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">_id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">format</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        req_obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">_id</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 根据 ID 查找单个数据</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">except</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Exception</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Response</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">status</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">status</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">HTTP_404_NOT_FOUND</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    serializer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">req_obj</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Response</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_6-请求与响应" tabindex="-1">6. 请求与响应 <a class="header-anchor" href="#_6-请求与响应" aria-label="Permalink to &quot;6. 请求与响应&quot;">​</a></h3><p>在纯 django 中，request 和 response 只能实现有限的功能。REST 框架对其作了扩展 ：</p><h4 id="请求对象-request-objects" tabindex="-1">请求对象（Request objects） <a class="header-anchor" href="#请求对象-request-objects" aria-label="Permalink to &quot;请求对象（Request objects）&quot;">​</a></h4><p>REST 框架引入了一个扩展了常规 HttpRequest 的 Request 对象，并提供了更灵活的请求解析。</p><p>Request 对象的核心功能是 request.data 属性，它与 request.POST 类似，但对于使用 Web API 更为有用。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">POST</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># 只处理表单数据 只适用于&#39;POST&#39;方法</span></span>
<span class="line"><span style="color:#A6ACCD;">request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;"># 处理任意数据 适用于&#39;POST&#39;，&#39;PUT&#39;和&#39;PATCH&#39;方法</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="响应对象-response-objects" tabindex="-1">响应对象（Response objects） <a class="header-anchor" href="#响应对象-response-objects" aria-label="Permalink to &quot;响应对象（Response objects）&quot;">​</a></h4><p>REST 框架还引入了一个 Response 对象，这是一种获取未渲染（unrendered）内容的 TemplateResponse 类型，并使用内容协商来确定返回给客户端的正确内容类型。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Response</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 渲染成客户端请求的内容类型。</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>默认情况下，Response 把响应内容嵌套在默认的模板中返回出去，所以我们看到的内容是网页形式，而不是单纯的数据。</p><h4 id="响应数据格式-扩展" tabindex="-1">响应数据格式 - 扩展 <a class="header-anchor" href="#响应数据格式-扩展" aria-label="Permalink to &quot;响应数据格式 - 扩展&quot;">​</a></h4><p>为 API 路径添加对格式后缀 如<a href="http://example.com/api/items/4.json%E4%B9%8B%E7%B1%BB%E7%9A%84URL" target="_blank" rel="noreferrer">http://example.com/api/items/4.json之类的URL</a></p><p>视图中添加一个 format 关键字参数。</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">api_view</span><span style="color:#89DDFF;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">request_list</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">format</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">method</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        serializer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#89DDFF;">(),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">many</span><span style="color:#89DDFF;">=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Response</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    	</span><span style="color:#676E95;font-style:italic;"># safe=False是为了支持{}以外的python对象转json</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>修改路由文件 sqtp/urls.py</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> django</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">urls </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> path</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> sqtp </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> views</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> rest_framework</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">urlpatterns </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> format_suffix_patterns</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">urlpatterns </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">path</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">requests/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">views</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">request_list</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">urlpatterns </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">format_suffix_patterns</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">urlpatterns</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>访问<a href="http://127.0.0.1:8000/requests.json" target="_blank" rel="noreferrer">http://127.0.0.1:8000/requests.json</a> ，返回了 json 格式的数据</p><h4 id="查询单个数据-扩展" tabindex="-1">查询单个数据 - 扩展 <a class="header-anchor" href="#查询单个数据-扩展" aria-label="Permalink to &quot;查询单个数据 - 扩展&quot;">​</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#82AAFF;">api_view</span><span style="color:#89DDFF;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">request_detail</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">request</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">_id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">format</span><span style="color:#89DDFF;">=None):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">获取，更新或删除一个req实例。</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        req_obj </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">pk</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">_id</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">except</span><span style="color:#A6ACCD;"> Request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">DoesNotExist</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Response</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">status</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">status</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">HTTP_404_NOT_FOUND</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># status提供常用http状态</span></span>
<span class="line"><span style="color:#A6ACCD;">        码</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">method</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            serializer </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RequestSerializer</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">req_obj</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Response</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">serializer</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>更新路由：sqtp/urls.py</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">urlpatterns </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">path</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">requests/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> views</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">request_list</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">path</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">requests/&lt;int:_id&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> views</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">request_detail</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">urlpatterns </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">format_suffix_patterns</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">urlpatterns</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>访问<a href="http://127.0.0.1:8000/requests/2" target="_blank" rel="noreferrer">http://127.0.0.1:8000/requests/2</a></p><p>或 <a href="http://127.0.0.1:8000/requests/2.json" target="_blank" rel="noreferrer">http://127.0.0.1:8000/requests/2.json</a></p><h2 id="附录" tabindex="-1">附录 <a class="header-anchor" href="#附录" aria-label="Permalink to &quot;附录&quot;">​</a></h2><p>可用的 Meta 选项：<a href="https://docs.djangoproject.com/zh-hans/3.2/ref/models/options/" target="_blank" rel="noreferrer">模型 Meta 选项 | Django 文档 | Django (djangoproject.com) </a></p>`,113),e=[o];function t(r,c,D,y,F,i){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{A as __pageData,d as default};
