import{_ as a,o as l,c as p,Q as n,x as s,a as o}from"./chunks/framework.1b72a0e7.js";const m=JSON.parse('{"title":"二、接口强化训练","description":"","frontmatter":{},"headers":[],"relativePath":"软件测试/接口自动化/接口强化训练.md","lastUpdated":1700034831000}'),e={name:"软件测试/接口自动化/接口强化训练.md"},t=n('<h1 id="二、接口强化训练" tabindex="-1">二、接口强化训练 <a class="header-anchor" href="#二、接口强化训练" aria-label="Permalink to &quot;二、接口强化训练&quot;">​</a></h1><h2 id="一、接口名词透析" tabindex="-1">一、接口名词透析 <a class="header-anchor" href="#一、接口名词透析" aria-label="Permalink to &quot;一、接口名词透析&quot;">​</a></h2><h3 id="_1-token-令牌" tabindex="-1">1. token - 令牌 <a class="header-anchor" href="#_1-token-令牌" aria-label="Permalink to &quot;1. token - 令牌&quot;">​</a></h3><ul><li><code>token</code> ： 由服务器产生，存在服务器的内存或硬盘中</li><li>有一套产生规则，会涉及到加密算法</li><li>根据 账户和密码 生成，用于验证 用户登录信息</li><li>主要通过 响应消息体传输给 客户端</li></ul><h3 id="_2-cookies" tabindex="-1">2. cookies <a class="header-anchor" href="#_2-cookies" aria-label="Permalink to &quot;2. cookies&quot;">​</a></h3><ul><li><code>cookies</code> ： 存储在 浏览器的某个位置</li><li>可以被禁用、删除，安全性不高</li><li><code>cookie</code> 是分站点的，站点与站点之间的 cookie 是相互独立的</li><li><code>cookie 与 sessionid</code> 配合实现登录</li></ul><h3 id="_3-sessionid" tabindex="-1">3. sessionId <a class="header-anchor" href="#_3-sessionid" aria-label="Permalink to &quot;3. sessionId&quot;">​</a></h3><ul><li><code>session</code> 是一个对象，由服务器产生， 保存在服务器的内存中</li><li>有自己的管理机制，包括 产生、销毁、超时等</li><li><code>sessionId</code> 是 <code>session</code> 对象的一个属性，是全局唯一的，永远都不会重复的</li></ul><h4 id="cookies-工作流程-主要里面就是-jsessionid" tabindex="-1">cookies 工作流程（主要里面就是 jsessionID） <a class="header-anchor" href="#cookies-工作流程-主要里面就是-jsessionid" aria-label="Permalink to &quot;cookies 工作流程（主要里面就是 jsessionID）&quot;">​</a></h4><ol><li>客户端发送一个请求到服务器</li><li>服务器返回响应数据--响应头--setCOOkies---给我们客户端</li><li>这个时候这个 cookies 不一定是有效！---需要登录的网站--临时 cookies</li><li>需要登录---服务器判断这个账号密码正确之后，之前的 cookies 变成可以使用的！</li></ol><h2 id="二、-接口强化训练" tabindex="-1">二、 接口强化训练 <a class="header-anchor" href="#二、-接口强化训练" aria-label="Permalink to &quot;二、 接口强化训练&quot;">​</a></h2><h3 id="_1-requests-库请求参数类型" tabindex="-1">1. requests 库请求参数类型 <a class="header-anchor" href="#_1-requests-库请求参数类型" aria-label="Permalink to &quot;1. requests 库请求参数类型&quot;">​</a></h3>',12),r=s("table",null,[s("thead",null,[s("tr",null,[s("th",null,"请求参 数"),s("th",null,"请求头中数据默认类 型"),s("th",null,"描述")])]),s("tbody",null,[s("tr",null,[s("td",null,"data"),s("td",null,"Content Type:application/x www-form urlencoded"),s("td",null,"请求体是表单格式 如：a=1&b=2")]),s("tr",{"name:tom":""},[s("td",null,"json"),s("td",null,"Content Type:application/json"),s("td",null,"请求体是 json 格式 如：")]),s("tr",null,[s("td",null,"params"),s("td",null,"暂时不考虑"),s("td",null,[o("参数是放到 url 上 如："),s("a",{href:"http://192.168.32.100:8080/%E8%B7%AF%E5%BE%84?a=1&b=2",target:"_blank",rel:"noreferrer"},"http://192.168.32.100:8080/路径?a=1&b=2")])]),s("tr",null,[s("td",null,"files"),s("td",null,"Content Type:multipart/form data"),s("td",null,"文件上传接口中使 用")])])],-1),c=n(`<h3 id="_2-请求与响应的对比" tabindex="-1">2. 请求与响应的对比 <a class="header-anchor" href="#_2-请求与响应的对比" aria-label="Permalink to &quot;2. 请求与响应的对比&quot;">​</a></h3><table><thead><tr><th>请求相关信息 resp.request.xxxx</th><th>响应相关信息 resp.xxxx</th></tr></thead><tbody><tr><td>resp.request.url 请求的 url</td><td>\\</td></tr><tr><td>resp.request.headers 请求 头信息</td><td>resp.headers 响应头 信息</td></tr><tr><td>resp.request.body 请求体信 息</td><td>resp.text 请求体信息</td></tr></tbody></table><h3 id="_3-requests-库响应消息体四种格式" tabindex="-1">3. requests 库响应消息体四种格式 <a class="header-anchor" href="#_3-requests-库响应消息体四种格式" aria-label="Permalink to &quot;3. requests 库响应消息体四种格式&quot;">​</a></h3><table><thead><tr><th>四种返回格式</th><th>说明</th><th>用处</th></tr></thead><tbody><tr><td>r.text : 文本响应内容</td><td>返回字符串类型</td><td>获取网页 html 时用</td></tr><tr><td>r.content ： 字节响应内容</td><td>返回字节类型</td><td>下载图片或文件时用</td></tr><tr><td>r.json() ： json 解码响应内容</td><td>返回字典格式</td><td>明确服务器返回 json 数据才能用</td></tr><tr><td>r.raw ： 原始响应内容</td><td>返回原始格式</td><td></td></tr></tbody></table><h2 id="三、-实战" tabindex="-1">三、 实战 <a class="header-anchor" href="#三、-实战" aria-label="Permalink to &quot;三、 实战&quot;">​</a></h2><h3 id="_1-token-实战" tabindex="-1">1. token 实战 <a class="header-anchor" href="#_1-token-实战" aria-label="Permalink to &quot;1. token 实战&quot;">​</a></h3><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># configs/config.py</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">HOST </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://121.41.14.39:8082</span><span style="color:#89DDFF;">&#39;</span><span style="color:#676E95;font-style:italic;">#便于维护--测试环境变更--测试环境-预生产环境-生产环境</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># login.py</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> requests</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> pprint</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#需求：输入一个字符串的密码，输出的一个md5加密结果</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> hashlib</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> configs</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">config </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> HOST</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># md5 加密</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">get_md5</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">password</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#1-实例化加密对象</span></span>
<span class="line"><span style="color:#A6ACCD;">    md5 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> hashlib</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">md5</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#2- 进行加密操作</span></span>
<span class="line"><span style="color:#A6ACCD;">    md5</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">password</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encode</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#3- 返回加密后的值</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> md5</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">hexdigest</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Login</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">inData</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">gettoken</span><span style="color:#89DDFF;">=False):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">#1-url</span></span>
<span class="line"><span style="color:#A6ACCD;">        url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&#39;</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">HOST</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">/account/sLogin&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">#2- 参数</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">#字典的修改值操作 字典[键] = 新的值</span></span>
<span class="line"><span style="color:#A6ACCD;">        inData</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">get_md5</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">inData</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">        payload </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> inData</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">#3-请求方法</span></span>
<span class="line"><span style="color:#A6ACCD;">        resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">params</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">payload</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> getToken </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">False:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#89DDFF;">()</span><span style="color:#676E95;font-style:italic;">#响应数据</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">json</span><span style="color:#89DDFF;">()[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">token</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;font-style:italic;">#token</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">({</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">username</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxxxxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxxxxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># pprint.pprint(res)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">res</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="_2-cookie-实战" tabindex="-1">2. cookie 实战 <a class="header-anchor" href="#_2-cookie-实战" aria-label="Permalink to &quot;2. cookie 实战&quot;">​</a></h3><p>前端访问路径：<a href="http://120.55.190.222:7080/mgr/login/login.html" target="_blank" rel="noreferrer">http://120.55.190.222:7080/mgr/login/login.html</a></p><h4 id="_1-登录接口" tabindex="-1">1.登录接口 <a class="header-anchor" href="#_1-登录接口" aria-label="Permalink to &quot;1.登录接口&quot;">​</a></h4><ul><li><p><strong>url:</strong></p><ul><li><p>http 协议 ： <a href="http://120.55.190.222:7080/api/mgr/loginReq" target="_blank" rel="noreferrer">http://120.55.190.222:7080/api/mgr/loginReq</a></p></li><li><p>https 协议 ： <a href="https://120.55.190.222/api/mgr/loginReq" target="_blank" rel="noreferrer">https://120.55.190.222/api/mgr/loginReq</a></p></li></ul></li><li><p><strong>请求体：</strong></p></li></ul><table><thead><tr><th>username</th><th>auto</th><th>必填</th></tr></thead><tbody><tr><td>password</td><td>sdfsdfsdf</td><td>必填</td></tr></tbody></table><ul><li><p>响应头</p><ul><li>Content-Type 必填 该字段值为 application/json，表示返回 JSON 格式的文本信息。</li><li>Set-Cookie 必填 该字段保存本次登录的 sessionid <ul><li>比如： <ul><li>sessionid=89emkau5vhyg8vcwfwvq2pvr7ul2t5sc</li></ul></li></ul></li></ul></li><li><p>响应体</p><ul><li><p>如果请求成功，返回 json 格式的消息体，如下所示，retcode 值为 0 表示登录认证成功</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">retcode</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li><li><p>如果输入的用户名或者密码错误，则返回结果为 cookie 实战描述</p><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">retcode</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">reason</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">用户或者密码错误</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li></ul><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">cookie的关联：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 提取cookie</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 后续接口使用cookie</span></span>
<span class="line"><span style="color:#A6ACCD;">思路：</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 原生态cookie直接使用</span></span>
<span class="line"><span style="color:#A6ACCD;">		resp</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">cookies</span><span style="color:#A6ACCD;"> ----后面接口</span></span>
<span class="line"><span style="color:#A6ACCD;">		requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">后续接口url</span><span style="color:#89DDFF;">&#39;</span><span style="color:#82AAFF;">，</span><span style="color:#A6ACCD;font-style:italic;">cookies</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;"> 获取到的原生态的cookie</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 需要额外增加一些参数到cookie--</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">定制化cookie</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="_2-cookie-原生态直接关联后续接口实战" tabindex="-1">2.cookie 原生态直接关联后续接口实战 <a class="header-anchor" href="#_2-cookie-原生态直接关联后续接口实战" aria-label="Permalink to &quot;2.cookie 原生态直接关联后续接口实战&quot;">​</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">HOST </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://120.55.190.222:7080</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#1- url</span></span>
<span class="line"><span style="color:#A6ACCD;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&#39;</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">HOST</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">/api/mgr/loginReq&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#2- 请求体</span></span>
<span class="line"><span style="color:#A6ACCD;">    payload </span><span style="color:#89DDFF;">={</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">username</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">auto</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sdfsdfsdf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">#3- 请求</span></span>
<span class="line"><span style="color:#A6ACCD;">     resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">payload</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">#获取cookie</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">#方案一：响应里就有这个cookie</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># print(resp.cookies)</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">cookies</span><span style="color:#676E95;font-style:italic;">#返回原生态的cookie</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#需要关联的接口</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add_lesson</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">userCookie</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 1- url</span></span>
<span class="line"><span style="color:#A6ACCD;">     url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&#39;</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">HOST</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">/api/mgr/sq_mgr/&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 3- 请求</span></span>
<span class="line"><span style="color:#A6ACCD;">     resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">cookies</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">userCookie</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">resp</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># 查看请求头的cookies</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">     userCookie</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#82AAFF;">add_lesson</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">userCookie</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h4 id="_3-自己封装-cookie-关联后续接口实战" tabindex="-1">3.自己封装 cookie 关联后续接口实战 <a class="header-anchor" href="#_3-自己封装-cookie-关联后续接口实战" aria-label="Permalink to &quot;3.自己封装 cookie 关联后续接口实战&quot;">​</a></h4><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">HOST </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">http://120.55.190.222:7080</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#1- url</span></span>
<span class="line"><span style="color:#A6ACCD;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&#39;</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">HOST</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">/api/mgr/loginReq&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#2- 请求体</span></span>
<span class="line"><span style="color:#A6ACCD;">     payload </span><span style="color:#89DDFF;">={</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">username</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">auto</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sdfsdfsdf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">#3- 请求</span></span>
<span class="line"><span style="color:#A6ACCD;">     resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">payload</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">#获取cookie</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">#方案二：需要额外增加一些参数到cookie---定制化cookie--提取sessionID</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">resp</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">cookies</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sessionid</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">cookies</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sessionid</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span><span style="color:#676E95;font-style:italic;">#返回原生态的cookie里的sessionID</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#需要关联的接口</span></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">add_lesson</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">userCookie</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 1- url</span></span>
<span class="line"><span style="color:#A6ACCD;">     url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&#39;</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">HOST</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">/api/mgr/sq_mgr/&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 3- 请求</span></span>
<span class="line"><span style="color:#A6ACCD;">     resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">cookies</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">userCookie</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">resp</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">request</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">)</span><span style="color:#676E95;font-style:italic;">#查看请求头的cookies</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">#自己封装cookie</span></span>
<span class="line"><span style="color:#A6ACCD;">     userCookie </span><span style="color:#89DDFF;">={</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sessionid</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">userSessionId</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">token</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">123456</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#82AAFF;">add_lesson</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">userCookie</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h4 id="_4-https-协议代码" tabindex="-1">4. https 协议代码 <a class="header-anchor" href="#_4-https-协议代码" aria-label="Permalink to &quot;4. https 协议代码&quot;">​</a></h4><blockquote><p>不做 https 校验 ： <code>verify =False</code></p><p>处理 pycharm https 警告 ： <code>requests.packages.urllib3.disable_warnings()</code></p></blockquote><div class="language-python line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#https协议</span></span>
<span class="line"><span style="color:#A6ACCD;">HOST </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://120.55.190.222</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#处理https警告</span></span>
<span class="line"><span style="color:#A6ACCD;">requests</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">packages</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">urllib3</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">disable_warnings</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#1- url</span></span>
<span class="line"><span style="color:#A6ACCD;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&#39;</span><span style="color:#F78C6C;">{</span><span style="color:#A6ACCD;">HOST</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;">/api/mgr/loginReq&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#2- 请求体</span></span>
<span class="line"><span style="color:#A6ACCD;">    payload </span><span style="color:#89DDFF;">={</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">username</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">auto</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sdfsdfsdf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#3- 请求</span></span>
<span class="line"><span style="color:#A6ACCD;">    resp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">post</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">data</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">payload</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;font-style:italic;">verify</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">=False)</span><span style="color:#676E95;font-style:italic;">#不使用SSL</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> resp</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">text</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">login</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">res</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div>`,22),i=[t,r,c];function y(D,F,A,C,b,u){return l(),p("div",null,i)}const h=a(e,[["render",y]]);export{m as __pageData,h as default};
